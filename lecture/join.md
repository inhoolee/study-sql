# JOIN

서로 다른 데이터 테이블을 연결하는 것

공통적으로 존재하는 컬럼(=Key)이 있다면, JOIN 할 수 있음

JOIN이 어려운 것이 아니고 테이블 구조에 익숙하지 않아서 어려움을 느낄 확률이 높음

## JOIN 방법

- (INNER) JOIN
- LEFT/RIGHT (OUTER) JOIN
- FULL (OUTER) JOIN
- CROSS JOIN

## 작성 흐름

- 테이블 확인
- 기준 테이블 정의
- JOIN Key 찾기
- 결과 예상하기
- 쿼리 작성 / 검증

## SQL JOIN을 처음 공부할 때 헷갈렸던 부분

### 1) 여러 JOIN 중 어떤 것을 사용해야 할까?

- 하려고 하는 작업의 목적에 따라 JOIN을 선택해보기
  - 교집합 : INNER
  - 모두 다 조합 : CROSS
  - 그게 아니라면 LEFT 또는 RIGHT : LEFT를 추천, 하나를 계속 활용하는 것을 추천
- 쿼리 작성 템플릿에 예상하는 결과를 작성하고, 중간 결과도 생각하면서 찾아보기

### 2) 어떤 Table을 왼쪽에 두고, 어떤 Table이 오른쪽에 가야할까?

- LEFT JOIN의 경우
  - 기준이 되는 Table을 왼쪽에 두기
- 기준에는 기준값이 존재하고, 우측에 데이터를 계속 추가

### 3) 컬럼은 모두 다 선택해야 할까?

- JOIN이 잘 되었나 확인하기 위해 처음엔 많은 컬럼을 선택해도 괜찮으나,
사용하지 않을 컬럼은 선택하지 않는 것이 BigQuery에서 비용을 줄일 수 있음
- id 같은 값은 Unique한지 확인하기 위해 자주 사용되므로 id는 자주 사용하는 편

## 연습 문제

1. 트레이너가 보유한 포켓몬들은 얼마나 있는지 알 수 있는 쿼리를 작성해주세요

2. 각 트레이너가 가진 포켓몬 중에서 'Grass' 타입의 포켓몬 수를 계산해주세요 (단, 편의를 위해 type1 기준으로 계산해주세요)

3. 트레이너의 고향(hometown)과 포켓몬을 포획한 위치(location)를 비교하여, 자신의 고향에서 포켓몬을 포획한 트레이너의 수를 계산해주세요.

4. Master 등급인 트레이너들은 어떤 타입의 포켓몬을 제일 많이 보유하고 있을까요?

5. Incheon 출신 트레이너들은 1세대, 2세대 포켓몬을 각각 얼마나 보유하고 있나요?

## 종합 문제

1) 포켓몬의 type1 별로 포켓몬 수와 평균 체력, 평균 공격력, 평균 방어력을 구해주세요.
   - 포켓몬 수를 내림차순해서 정렬해주세요.
   - 평균을 구할 때는 소수점 둘째 자리로 반올림 해주세요

2) 가장 많은 배틀에서 승리한 상위 5명의 트레이너의 이름을 출력해주세요

3) **보유한** 포켓몬의 평균 레벨이 25 이상인 트레이너를 구해주세요. 정렬은 평균 레벨을 내림차순으로 해주세요

4) 월별 player1들의 포켓몬 배틀 수와 승률을 구해주세요.
월은 2023-06, 2023-07의 형태(‘%Y-%m’)으로 작성해주세요
   - FORMAT_TIMESTAMP 함수

5) 포켓몬 배틀은 새벽, 아침, 점심, 저녁, 밤 중 언제 제일 많이 진행되었나요?
   - 0~5 : Dawn
   - 6~11 : Morning
   - 12~17 : Afternoon
   - 18~21 : Evening
   - 그 외 Night
